function LAppModel(){L2DBaseModel.prototype.constructor.call(this),this.modelHomeDir="",this.modelSetting=null,this.tmpMatrix=[]}LAppModel.prototype=new L2DBaseModel,LAppModel.prototype.load=function(a,b,c){this.setUpdating(!0),this.setInitialized(!1),this.modelHomeDir=b.substring(0,b.lastIndexOf("/")+1),this.modelSetting=new ModelSettingJson;var d=this;this.modelSetting.loadModelSetting(b,function(){var a=d.modelHomeDir+d.modelSetting.getModelFile();d.loadModelData(a,function(a){for(var b=0;b<d.modelSetting.getTextureNum();b++){var e=d.modelHomeDir+d.modelSetting.getTextureFile(b);d.loadTexture(b,e,function(){if(d.isTexLoaded){if(d.modelSetting.getExpressionNum()>0){d.expressions={};for(var a=0;a<d.modelSetting.getExpressionNum();a++){var b=d.modelSetting.getExpressionName(a),e=d.modelHomeDir+d.modelSetting.getExpressionFile(a);d.loadExpression(b,e)}}else d.expressionManager=null,d.expressions={};if(null==d.eyeBlink&&(d.eyeBlink=new L2DEyeBlink),null!=d.modelSetting.getPhysicsFile()?d.loadPhysics(d.modelHomeDir+d.modelSetting.getPhysicsFile()):d.physics=null,null!=d.modelSetting.getPoseFile()?d.loadPose(d.modelHomeDir+d.modelSetting.getPoseFile(),function(){d.pose.updateParam(d.live2DModel)}):d.pose=null,null!=d.modelSetting.getLayout()){var f=d.modelSetting.getLayout();null!=f.width&&d.modelMatrix.setWidth(f.width),null!=f.height&&d.modelMatrix.setHeight(f.height),null!=f.x&&d.modelMatrix.setX(f.x),null!=f.y&&d.modelMatrix.setY(f.y),null!=f.center_x&&d.modelMatrix.centerX(f.center_x),null!=f.center_y&&d.modelMatrix.centerY(f.center_y),null!=f.top&&d.modelMatrix.top(f.top),null!=f.bottom&&d.modelMatrix.bottom(f.bottom),null!=f.left&&d.modelMatrix.left(f.left),null!=f.right&&d.modelMatrix.right(f.right)}for(var a=0;a<d.modelSetting.getInitParamNum();a++)d.live2DModel.setParamFloat(d.modelSetting.getInitParamID(a),d.modelSetting.getInitParamValue(a));for(var a=0;a<d.modelSetting.getInitPartsVisibleNum();a++)d.live2DModel.setPartsOpacity(d.modelSetting.getInitPartsVisibleID(a),d.modelSetting.getInitPartsVisibleValue(a));d.live2DModel.saveParam(),d.preloadMotionGroup(LAppDefine.MOTION_GROUP_IDLE),d.mainMotionManager.stopAllMotions(),d.setUpdating(!1),d.setInitialized(!0),"function"==typeof c&&c()}})}})})},LAppModel.prototype.release=function(a){var b=Live2DFramework.getPlatformManager();a.deleteTexture(b.texture)},LAppModel.prototype.preloadMotionGroup=function(a){for(var b=this,c=0;c<this.modelSetting.getMotionNum(a);c++){var d=this.modelSetting.getMotionFile(a,c);this.loadMotion(d,this.modelHomeDir+d,function(d){d.setFadeIn(b.modelSetting.getMotionFadeIn(a,c)),d.setFadeOut(b.modelSetting.getMotionFadeOut(a,c))})}},LAppModel.prototype.update=function(){if(null==this.live2DModel)return void(LAppDefine.DEBUG_LOG&&console.error("Failed to update."));var a=UtSystem.getUserTimeMSec()-this.startTimeMSec,b=a/1e3,c=2*b*Math.PI;this.mainMotionManager.isFinished()&&this.startRandomMotion(LAppDefine.MOTION_GROUP_IDLE,LAppDefine.PRIORITY_IDLE),this.live2DModel.loadParam();var d=this.mainMotionManager.updateParam(this.live2DModel);d||null!=this.eyeBlink&&this.eyeBlink.updateParam(this.live2DModel),this.live2DModel.saveParam(),null==this.expressionManager||null==this.expressions||this.expressionManager.isFinished()||this.expressionManager.updateParam(this.live2DModel),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",30*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",30*this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",this.dragX*this.dragY*-30,1),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",10*this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_X",this.dragX,1),this.live2DModel.addToParamFloat("PARAM_EYE_BALL_Y",this.dragY,1),this.live2DModel.addToParamFloat("PARAM_ANGLE_X",Number(15*Math.sin(c/6.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Y",Number(8*Math.sin(c/3.5345)),.5),this.live2DModel.addToParamFloat("PARAM_ANGLE_Z",Number(10*Math.sin(c/5.5345)),.5),this.live2DModel.addToParamFloat("PARAM_BODY_ANGLE_X",Number(4*Math.sin(c/15.5345)),.5),this.live2DModel.setParamFloat("PARAM_BREATH",Number(.5+.5*Math.sin(c/3.2345)),1),null!=this.physics&&this.physics.updateParam(this.live2DModel),null==this.lipSync&&this.live2DModel.setParamFloat("PARAM_MOUTH_OPEN_Y",this.lipSyncValue),null!=this.pose&&this.pose.updateParam(this.live2DModel),this.live2DModel.update()},LAppModel.prototype.setRandomExpression=function(){var a=[];for(var b in this.expressions)a.push(b);var c=parseInt(Math.random()*a.length);this.setExpression(a[c])},LAppModel.prototype.startRandomMotion=function(a,b){var c=this.modelSetting.getMotionNum(a),d=parseInt(Math.random()*c);this.startMotion(a,d,b)},LAppModel.prototype.startMotion=function(a,b,c){var d=this.modelSetting.getMotionFile(a,b);if(null==d||""==d)return void(LAppDefine.DEBUG_LOG&&console.error("Failed to motion."));if(c==LAppDefine.PRIORITY_FORCE)this.mainMotionManager.setReservePriority(c);else if(!this.mainMotionManager.reserveMotion(c))return void(LAppDefine.DEBUG_LOG&&console.log("Motion is running."));var f,e=this;null==this.motions[a]?this.loadMotion(null,this.modelHomeDir+d,function(d){f=d,e.setFadeInFadeOut(a,b,c,f)}):(f=this.motions[a],e.setFadeInFadeOut(a,b,c,f))},LAppModel.prototype.setFadeInFadeOut=function(a,b,c,d){var e=this.modelSetting.getMotionFile(a,b);if(d.setFadeIn(this.modelSetting.getMotionFadeIn(a,b)),d.setFadeOut(this.modelSetting.getMotionFadeOut(a,b)),LAppDefine.DEBUG_LOG&&console.log("Start motion : "+e),null==this.modelSetting.getMotionSound(a,b))this.mainMotionManager.startMotionPrio(d,c);else{var f=this.modelSetting.getMotionSound(a,b),g=document.createElement("audio");g.src=this.modelHomeDir+f,LAppDefine.DEBUG_LOG&&console.log("Start sound : "+f),g.play(),this.mainMotionManager.startMotionPrio(d,c)}},LAppModel.prototype.setExpression=function(a){var b=this.expressions[a];LAppDefine.DEBUG_LOG&&console.log("Expression : "+a),this.expressionManager.startMotion(b,!1)},LAppModel.prototype.draw=function(a){MatrixStack.push(),MatrixStack.multMatrix(this.modelMatrix.getArray()),this.tmpMatrix=MatrixStack.getMatrix(),this.live2DModel.setMatrix(this.tmpMatrix),this.live2DModel.draw(),MatrixStack.pop()},LAppModel.prototype.hitTest=function(a,b,c){for(var d=this.modelSetting.getHitAreaNum(),e=0;e<d;e++)if(a==this.modelSetting.getHitAreaName(e)){var f=this.modelSetting.getHitAreaID(e);return this.hitTestSimple(f,b,c)}return!1};